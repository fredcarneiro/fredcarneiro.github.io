webpackJsonp([1],[,function(a,b,c){"use strict";function d(a){return a instanceof l||Object.getPrototypeOf(a)instanceof l}function e(a){return d(a)?a.message:(console.log(a),"N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o.")}function f(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function g(a){throw new Error(`${a} é obrigatório.`)}function h(a=500){return function(b,c,d){const e=d.value;let f=0;return d.value=function(...b){event&&event.preventDefault(),clearTimeout(f),f=setTimeout(()=>e.apply(this,b),a)},d}}function i(...a){function b(a,b){document.querySelector(b.selector).addEventListener(b.event,(c)=>{b.prevent&&c.preventDefault(),a[b.propertyKey](c)})}const c=a.map((a)=>document.querySelector(a));return function(a){const d=a,e=function(){const a=new d(...c);return Object.getOwnPropertyNames(d.prototype).forEach((c)=>{Reflect.hasMetadata("bindEvent",a,c)&&b(a,Reflect.getMetadata("bindEvent",a,c))}),new d(...c)};return e.prototype=d.prototype,e}}function j(a=g("event"),b=g("selector"),c=!0){return function(d,e,f){return Reflect.defineMetadata("bindEvent",{event:a,selector:b,prevent:c,propertyKey:e},Object.getPrototypeOf(d),e),f}}Object.defineProperty(b,"__esModule",{value:!0});let k=class extends Error{constructor(a=""){super(a),this.name=this.constructor.name}};const l=k;let m=class a{static create(b,c,d){return new Proxy(b,{get(b,e){return a._ehFuncao(b[e])&&c.includes(e)?function(){b[e].apply(b,arguments),d(b)}:b[e]},set(a,b,e){const f=Reflect.set(a,b,e);return c.includes(b)&&d(a),f}})}static _ehFuncao(a){return typeof a==typeof Function}},n=class{constructor(a,b,...c){const d=m.create(a,c,(a)=>b.update(a));return b.update(a),d}};const o=["negociacoes"];let p=class a{constructor(){throw new Error("Essa classe n\xE3o pode ser instanciada.")}static getConnection(){return new Promise((b,c)=>{const d=indexedDB.open("cangaceiro",1);d.onupgradeneeded=(b)=>{let c=b.target.result;a._createStore(c)},d.onsuccess=(a)=>{let c=a.target.result,d=c.close.bind(c);c.close=()=>{throw new Error("Voc\xEA n\xE3o pode fechar diretamente a conex\xE3o.")},b(c)},d.onerror=(a)=>{console.log(a.target.error),c(a.target.error.name)}})}static _createStore(a){o.forEach((b)=>{a.objectStoreNames.contains(b)&&a.deleteObjectStore(b),a.createObjectStore(b,{autoIncrement:!0})})}static closeConnection(){}};var q=c(4);let r=(()=>{var a=f(function*(){let a=yield p.getConnection();return new q.a(a)});return function(){return a.apply(this,arguments)}})(),s=class a{static get_xmlhttpservice(a){return new Promise((b,c)=>{const d=new XMLHttpRequest;d.open("GET",a),d.onreadystatechange=()=>{4==d.readyState&&(200==d.status?b(JSON.parse(d.responseText)):c(d.responseText))},d.send()})}static _handleError(a){if(!a.ok)throw new Error(a.statusText);return a}static get(b){return fetch(b).then((b)=>a._handleError(b)).then((a)=>a.json())}};c.d(b,"a",function(){return k}),c.d(b,!1,function(){return d}),c.d(b,"g",function(){return e}),c.d(b,"b",function(){return n}),c.d(b,!1,function(){return p}),c.d(b,"h",function(){return r}),c.d(b,"c",function(){return s}),c.d(b,!1,function(){return m}),c.d(b,"i",function(){return g}),c.d(b,"f",function(){return h}),c.d(b,"e",function(){return i}),c.d(b,"d",function(){return j})},function(a,b,c){"use strict";c.d(b,"a",function(){return e});var d=c(1);let e=class{constructor(a=d.i("data"),b=d.i("quantidade"),c=d.i("valor")){Object.assign(this,{_valor:c,_quantidade:b}),this._data=new Date(a.getTime()),Object.freeze(this)}get volume(){return this._quantidade*this._valor}get data(){return new Date(this._data.getTime())}get quantidade(){return this._quantidade}get valor(){return this._valor}equals(a){return JSON.stringify(this)==JSON.stringify(a)}}},,function(a,b,c){"use strict";c.d(b,"a",function(){return e});var d=c(2);let e=class{constructor(a){this._connection=a,this._store="negociacoes"}adiciona(a){return new Promise((b,c)=>{const d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).add(a);d.onsuccess=()=>b(),d.onerror=(a)=>{console.log(a.target.error),c("N\xE3o foi possivel salvar a negocia\xE7\xE3o")}})}listaTodos(){return new Promise((a,b)=>{const c=[],e=this._connection.transaction([this._store],"readwrite").objectStore(this._store).openCursor();e.onsuccess=(b)=>{const e=b.target.result;if(e){const a=new d.a(e.value._data,e.value._quantidade,e.value._valor);c.push(a),e.continue()}else a(c)},e.onerror=(a)=>{b(a.target.error)}})}excluirTodos(){return new Promise((a,b)=>{const c=this._connection.transaction([this._store],"readwrite").objectStore(this._store).clear();c.onsuccess=()=>a(),c.onerror=(a)=>{console.log(a.target.error),b("N\xE3o foi possivel apagar as negocia\xE7\xF5es")}})}}},function(a,b,c){"use strict";function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}Object.defineProperty(b,"__esModule",{value:!0});let f=class{constructor(){this._negociacoes=[],Object.freeze(this)}adiciona(a){this._negociacoes.push(a)}paraArray(){return[].concat(this._negociacoes)}get volumeTotal(){return this._negociacoes.reduce((a,b)=>a+b.volume,0)}esvazia(){this._negociacoes.length=0}};var g=c(2),h=c(4);let i=class{constructor(a){this._elemento=document.querySelector(a)}update(a){this._elemento.innerHTML=this.template(a)}template(){throw new Error("Voc\xEA precisa implementar o m\xE9todo template.")}},j=class extends i{template(a){return a.texto?`<p class="alert alert-info">${a.texto}</p>`:`<p></p>`}};var k=c(1);let l=class extends k.a{constructor(){super("A data deve estar no formato dd/mm/aaaa")}},m=class{constructor(){throw new Error("Essa classe n\xE3o pode ser instanciada.")}static paraTexto(a){return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()}`}static paraData(a){if(!/^\d{2}\/\d{2}\/\d{4}$/.test(a))throw new l("A data deve estar no formato dd/mm/aaaa");return new Date(...a.split("/").reverse().map((a,b)=>a-b%2))}},n=class extends i{template(a){return`
            <table class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>DATA</th>
                        <th>QUANTIDADE</th>
                        <th>VALOR</th>
                        <th>VOLUME</th>
                    </tr>
                </thead>
                
                <tbody>
                    ${a.paraArray().map((a)=>`
                            <tr>
                                <td>${m.paraTexto(a.data)}</td>
                                <td>${a.quantidade}</td>
                                <td>${a.valor}</td>
                                <td>${a.volume}</td>
                            </tr>
                        `).join("")}
                </tbody>
                
                <tfoot>
                    <tr>
                        <td colspan="3" align='right'>Volume Total</td>
                        <td>${a.volumeTotal}</td>
                    </tr>
                </tfoot>
            </table>
        `}},o=class{constructor(a=""){Object.assign(this,{_texto:a})}get texto(){return this._texto}set texto(a){this._texto=a}};var p,q,r,s,t,u,v,w,x=c(1);let y=(p=x.e("#valor","#quantidade","#data"),q=x.d("submit",".form"),r=x.f(),s=x.d("click","#botao-apaga"),t=x.d("click","#botao-importa"),u=x.f(),p(v=(w=class{constructor(a,b,c){document.querySelector.bind(document);Object.assign(this,{_data:c,_quantidade:b,_valor:a}),this._negociacoes=new x.b(new f(),new n("#negociacoes"),"adiciona","esvazia"),this._mensagem=new x.b(new o(),new j("#mensagem"),"texto"),this._init()}_init(){var a=this;return d(function*(){try{const b=yield x.h(),c=yield b.listaTodos();c.forEach(function(b){return a._negociacoes.adiciona(b)})}catch(b){a._mensagem.texto=x.g(b)}})()}adiciona(a){var b=this;return d(function*(){try{try{a.preventDefault();const c=b._criaNegociacao(),d=yield x.h();yield d.adiciona(c),b._negociacoes.adiciona(b._criaNegociacao()),b._mensagem.texto="Negocia\xE7\xE3o adicionada com sucesso.",b._limpaFormulario()}catch(a){b._mensagem.texto=x.g(a)}}catch(a){console.log(a),console.log(a.stack),b._mensagem.texto=a instanceof DataInvalidaException?a.message:"Um erro inesperado aconteceu. Entre em contato com o suporte."}})()}_limpaFormulario(){this._data.value="",this._quantidade.value=1,this._valor.value=0,this._data.focus()}_criaNegociacao(){return new g.a(m.paraData(this._data.value),parseInt(this._quantidade.value),parseFloat(this._valor.value))}limparNegociacoes(){var a=this;return d(function*(){try{const b=yield x.h();yield b.excluirTodos(),a._negociacoes.esvazia(),a._mensagem.texto="Negocia\xE7\xF5es excluidas."}catch(b){a._mensagem.texto=x.g(b)}})()}importaNegociacoes(){var a=this;return d(function*(){try{const{NegociacaoService:b}=yield c.e(0).then(c.bind(null,25)),d=new b;let e=yield d.obterNegociacoesDoPeriodo();e.filter(function(b){return!a._negociacoes.paraArray().some(function(a){return b.equals(a)})}).forEach(function(b){return a._negociacoes.adiciona(b)}),a._mensagem.texto="Negocia\xE7\xF5es importadas com sucesso."}catch(b){a._mensagem.texto=x.g(b)}})()}},e(w.prototype,"adiciona",[q,r],Object.getOwnPropertyDescriptor(w.prototype,"adiciona"),w.prototype),e(w.prototype,"limparNegociacoes",[s],Object.getOwnPropertyDescriptor(w.prototype,"limparNegociacoes"),w.prototype),e(w.prototype,"importaNegociacoes",[t,u],Object.getOwnPropertyDescriptor(w.prototype,"importaNegociacoes"),w.prototype),w))||v);var z=c(6),A=c.n(z),B=c(7),C=c.n(B),D=c(3),E=c.n(D),F=c(8),G=c.n(F);const H=new y,I=new g.a(new Date(),1,200),J=new Headers;J.set("Content-Type","application/json");const K=JSON.stringify(I);fetch("http://localhost:3000/negociacoes",{method:"POST",headers:J,body:K}).then(()=>console.log("Dado enviado com sucesso"))},function(){},function(){},function(){}],[5]);